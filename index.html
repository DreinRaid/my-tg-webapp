<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bot WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #212121);
            --tg-text: var(--tg-theme-text-color, #ffffff);
            --tg-hint: var(--tg-theme-hint-color, #aaaaaa);
            --tg-link: var(--tg-theme-link-color, #8774e1);
            --tg-button: var(--tg-theme-button-color, #8774e1);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #181818);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            color: var(--tg-text);
            background-color: var(--tg-bg);
        }
        .card {
            background-color: var(--tg-secondary-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        h2 { margin-top: 0; font-size: 18px; }
        p { color: var(--tg-hint); font-size: 14px; margin-top: 5px; }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            color: var(--tg-button-text);
            background-color: var(--tg-button);
            cursor: pointer;
            margin-top: 10px;
        }
        .button-danger { background-color: #e53935; }
        .data-placeholder { font-style: italic; color: var(--tg-hint); }
    </style>
</head>
<body>

    <div class="card">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: <span id="accounts-count" class="data-placeholder">–∑–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p>–°–æ–±—Ä–∞–Ω–æ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: <span id="audience-count" class="data-placeholder">–∑–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <button id="refresh-button">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <div class="card">
        <h2>üì¢ –ù–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</h2>
        <p>–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É –∏—Å—Ç–æ—Ä–∏–π –ø–æ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.</p>
        <button id="broadcast-button">–ù–∞—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
    </div>

    <div class="card">
        <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π</h2>
        <p>–°–∫–∞—á–∞—Ç—å –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
        <button id="download-button">–°–∫–∞—á–∞—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <button id="clear-button" class="button-danger">–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        function sendCommand(command, data = {}) {
            const payload = JSON.stringify({ command, ...data });
            tg.sendData(payload);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('refresh-button').addEventListener('click', () => {
            sendCommand('get_stats');
            tg.HapticFeedback.impactOccurred('light');
        });

        document.getElementById('broadcast-button').addEventListener('click', () => {
            tg.showConfirm("–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É –∏—Å—Ç–æ—Ä–∏–π?", (confirmed) => {
                if (confirmed) {
                    sendCommand('start_broadcast');
                }
            });
        });

        document.getElementById('download-button').addEventListener('click', () => {
            sendCommand('download_audience');
            tg.HapticFeedback.impactOccurred('light');
        });

        document.getElementById('clear-button').addEventListener('click', () => {
            tg.showConfirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.", (confirmed) => {
                if (confirmed) {
                    sendCommand('clear_audience');
                }
            });
        });

        // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞ ---
        // (–≠—Ç–æ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º—ã –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –±–æ—Ç –Ω–∞—É—á–∏—Ç—Å—è –ø—Ä–∏—Å—ã–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ WebApp)
        // tg.onEvent('viewportChanged', (isStable) => {
        //     if (isStable) {
        //         sendCommand('get_stats');
        //     }
        // });

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        sendCommand('get_stats');

    </script>

</body>
</html>